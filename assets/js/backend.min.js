$id=e=>document.getElementById(e),$class=e=>Array.from(document.getElementsByClassName(e));const md5=function(e){return M(V(Y(X(e),8*e.length))).toLowerCase()};function M(e){for(var t,n="0123456789ABCDEF",i="",r=0;r<e.length;r++)t=e.charCodeAt(r),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function X(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function V(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function Y(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,i=-271733879,r=-1732584194,a=271733878,s=0;s<e.length;s+=16){var l=n,o=i,c=r,d=a;i=md5_ii(i=md5_ii(i=md5_ii(i=md5_ii(i=md5_hh(i=md5_hh(i=md5_hh(i=md5_hh(i=md5_gg(i=md5_gg(i=md5_gg(i=md5_gg(i=md5_ff(i=md5_ff(i=md5_ff(i=md5_ff(i,r=md5_ff(r,a=md5_ff(a,n=md5_ff(n,i,r,a,e[s+0],7,-680876936),i,r,e[s+1],12,-389564586),n,i,e[s+2],17,606105819),a,n,e[s+3],22,-1044525330),r=md5_ff(r,a=md5_ff(a,n=md5_ff(n,i,r,a,e[s+4],7,-176418897),i,r,e[s+5],12,1200080426),n,i,e[s+6],17,-1473231341),a,n,e[s+7],22,-45705983),r=md5_ff(r,a=md5_ff(a,n=md5_ff(n,i,r,a,e[s+8],7,1770035416),i,r,e[s+9],12,-1958414417),n,i,e[s+10],17,-42063),a,n,e[s+11],22,-1990404162),r=md5_ff(r,a=md5_ff(a,n=md5_ff(n,i,r,a,e[s+12],7,1804603682),i,r,e[s+13],12,-40341101),n,i,e[s+14],17,-1502002290),a,n,e[s+15],22,1236535329),r=md5_gg(r,a=md5_gg(a,n=md5_gg(n,i,r,a,e[s+1],5,-165796510),i,r,e[s+6],9,-1069501632),n,i,e[s+11],14,643717713),a,n,e[s+0],20,-373897302),r=md5_gg(r,a=md5_gg(a,n=md5_gg(n,i,r,a,e[s+5],5,-701558691),i,r,e[s+10],9,38016083),n,i,e[s+15],14,-660478335),a,n,e[s+4],20,-405537848),r=md5_gg(r,a=md5_gg(a,n=md5_gg(n,i,r,a,e[s+9],5,568446438),i,r,e[s+14],9,-1019803690),n,i,e[s+3],14,-187363961),a,n,e[s+8],20,1163531501),r=md5_gg(r,a=md5_gg(a,n=md5_gg(n,i,r,a,e[s+13],5,-1444681467),i,r,e[s+2],9,-51403784),n,i,e[s+7],14,1735328473),a,n,e[s+12],20,-1926607734),r=md5_hh(r,a=md5_hh(a,n=md5_hh(n,i,r,a,e[s+5],4,-378558),i,r,e[s+8],11,-2022574463),n,i,e[s+11],16,1839030562),a,n,e[s+14],23,-35309556),r=md5_hh(r,a=md5_hh(a,n=md5_hh(n,i,r,a,e[s+1],4,-1530992060),i,r,e[s+4],11,1272893353),n,i,e[s+7],16,-155497632),a,n,e[s+10],23,-1094730640),r=md5_hh(r,a=md5_hh(a,n=md5_hh(n,i,r,a,e[s+13],4,681279174),i,r,e[s+0],11,-358537222),n,i,e[s+3],16,-722521979),a,n,e[s+6],23,76029189),r=md5_hh(r,a=md5_hh(a,n=md5_hh(n,i,r,a,e[s+9],4,-640364487),i,r,e[s+12],11,-421815835),n,i,e[s+15],16,530742520),a,n,e[s+2],23,-995338651),r=md5_ii(r,a=md5_ii(a,n=md5_ii(n,i,r,a,e[s+0],6,-198630844),i,r,e[s+7],10,1126891415),n,i,e[s+14],15,-1416354905),a,n,e[s+5],21,-57434055),r=md5_ii(r,a=md5_ii(a,n=md5_ii(n,i,r,a,e[s+12],6,1700485571),i,r,e[s+3],10,-1894986606),n,i,e[s+10],15,-1051523),a,n,e[s+1],21,-2054922799),r=md5_ii(r,a=md5_ii(a,n=md5_ii(n,i,r,a,e[s+8],6,1873313359),i,r,e[s+15],10,-30611744),n,i,e[s+6],15,-1560198380),a,n,e[s+13],21,1309151649),r=md5_ii(r,a=md5_ii(a,n=md5_ii(n,i,r,a,e[s+4],6,-145523070),i,r,e[s+11],10,-1120210379),n,i,e[s+2],15,718787259),a,n,e[s+9],21,-343485551),n=safe_add(n,l),i=safe_add(i,o),r=safe_add(r,c),a=safe_add(a,d)}return Array(n,i,r,a)}function md5_cmn(e,t,n,i,r,a){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(i,a)),r),n)}function md5_ff(e,t,n,i,r,a,s){return md5_cmn(t&n|~t&i,e,t,r,a,s)}function md5_gg(e,t,n,i,r,a,s){return md5_cmn(t&i|n&~i,e,t,r,a,s)}function md5_hh(e,t,n,i,r,a,s){return md5_cmn(t^n^i,e,t,r,a,s)}function md5_ii(e,t,n,i,r,a,s){return md5_cmn(n^(t|~i),e,t,r,a,s)}function safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}class FileRw{constructor(e){this.model=e}read=(e,t=(()=>{}))=>{const n={action:"read",filename:e},i=new FormData;for(let e in n)i.append(e,n[e]);fetch("/ajax/file-rw",{method:"post",body:i}).then((e=>e.text().then((e=>{t(e)}))))};write=(e,t,n=(()=>{}))=>{const i={action:"write",filename:e,content:t},r=new FormData;for(let e in i)r.append(e,i[e]);fetch("/ajax/file-rw",{method:"post",body:r}).then((t=>t.text().then((t=>{console.log(e),n(t)}))))};loadTex=(e,t)=>{const n="local"==new URL(window.location.href).searchParams.get("from")?"local":"remote",i=this.model.config,r=i[n+"-url"]+"tex-source/?filename="+e;console.log(r),fetch("/ajax/file-rw",{method:"post",body:{action:"read",filename:r}}).then((e=>{t(e.text())}));const a='"C:/Program Files (x86)/Texmaker/texmaker.exe" '+i["latex-dir"]+e+".tex";fetch("/ajax/file-rw",{method:"post",body:{action:"write",filename:"C:/batchs/OpenTex.bat",content:a}}).then((e=>{console.log("OpenTex.bat : "),console.log(a)}))};backup=(e,t)=>{const n=this.model.config,i=n["latex-dir"]+e.basename+".tex",r=new Date(2020,1,1),a=new Date,s=n["backup-dir"]+e.basename+"-"+Math.floor((a.getTime()-r.getTime())/1e3)+".tex";this.write(i,t),this.write(s,t),console.log(s)};transfert=(e,t,n,i="local")=>{};transfert_pdf=e=>{const t=this.model.config,n=t["latex-dir"]+e.basename+".pdf",i=n.replace(t["local-dir"],t["remote-dir"]);this.transfert_ftp(n,i,(e=>{console.log(e),console.log(n+" -> "+i)}))};transfert_src=e=>{const t=this.model.config,n=new RegExp('src="'+t["psimg-url"]+'([^"]*)"',"g");let i=n.exec(e);for(;i;){const r=t["psimg-dir"]+i[1],a=r.replace(t["local-dir"],t["remote-dir"]);this.transfert_ftp(r,a,(e=>{console.log(e)})),i=n.exec(e)}};transfert_ftp=(e,t,n=(()=>{}))=>{fetch("/ajax/file-rw",{method:"post",body:{action:"transfert",src:e,dest:t,config:JSON.stringify(this.model.config)}}).then((e=>{n(e.text())}))}}class Shortkeys{static maths=e=>{const t={cc:"\\mathbb{C} @",dd:"\\mathbb{D} @",nn:"\\mathbb{N} @",qq:"\\mathbb{Q} @",rr:"\\mathbb{R} @",zz:"\\mathbb{Z} @",curs:"\\mathscr{@} @",ga:"\\alpha @",ge:"\\epsilon @",gb:"\\beta @",gd:"\\delta @",gg:"\\gamma @",gD:"\\Delta @",gG:"\\Gamma @",gO:"\\Omega @",gF:"\\Phi @",gP:"\\Pi @",gS:"\\Sigma @",gl:"\\lambda @",gm:"\\mu @",go:"\\omega @",gf:"\\phi @",gp:"\\pi @",gq:"\\psi @",gr:"\\rho @",gs:"\\sigma @",gt:"\\theta @","|->":" \\longmapsto @","*":" \\times @","=>":" \\Rightarrow @",oo:" \\infty @","+oo":" +\\infty @","-oo":" -\\infty @",ssi:" \\Leftrightarrow @","~":" \\approx @","<=":" \\leqslant @",">=":" \\geqslant @","!=":" \\neq @","O/":" \\varnothing @",lim:" \\lim\\limits_{ @ \\rightarrow @ } @",limn:" \\lim\\limits_{ n \\rightarrow +\\infty } @",inter:" \\cap @",union:" \\cup @","*":" \\times @",".":" \\cdot @","...":" \\cdots @",in:" \\in @","!in":" \\notin @",inc:" \\subset @",pi:" \\pi @",cut:"$\\nosp$@",fr:"\\frac{ @ }{ @ } @",rc:"\\sqrt{ @ } @",cos:" \\cos @",ln:" \\ln @",sin:" \\sin @",tan:" \\tan @","{":" \\left\\{ @ \\right\\} @","\\":"\\backslash @",ang:" \\widehat{ @ } @",bar:" \\overline{ @ } @","|":" \\left| @ \\right| @","||":" \\lVert @ \\rVert @","(":" \\left( @ \\right) @","[":" \\left[ @ \\right] @","[]":" \\left[ @~;~@ \\right] @","][":" \\left] @~;~@ \\right[ @","[[":" \\left[ @~;~@ \\right[ @","]]":" \\left] @~;~@ \\right] @","()":" \\left( @~;~@ \\right) @",vec:" \\overrightarrow{ @ } @",exp:" \\text{e}^{ @ } @",ex:" \\text{e}^{ x } @",int:" \\int_{@}^{@} @ \\text{d}@",sys:" \\left\\{ \\begin{matrix}  @  \\\\  @  \\\\  @   \\end{matrix} \\right. @",mat:" \\begin{pmatrix} @ \\\\ @ \\end{pmatrix} @",col2:" \\begin{multicols}{2}\n\\columnbreak\n\n @ \\end{multicols}@ "};return e in t&&t[e]};static noMaths=e=>{const t={"":"\\\\@","\\\\":"\\par@","\\par":"\\medskip@","\\medskip":"\\bigskip@",":":String.fromCharCode(126)+": @",";":String.fromCharCode(126)+"; @",_:"_{ @ } @","^":"^{ @ } @","%":"\\% @",bold:" \\textbf{@} @",width:'style="width:4@0rem"',og:" \\og @ \\fg{} @",it:" \\textit{@} @",code:"\\begin{code}\n @ \n\\end{code}\n",note:"\\begin{note}\n @ \n\\end{note}\n",h2:"\\begin{h2} @ \\end{h2}\n",h3:"\\begin{h3} @ \\end{h3}\n",def:"\n\\cadre{bleu}{Définition}{ % id=d@ \n} % fin définition@",th:"\n\\cadre{rouge}{Théorème}{ % id=t@ \n} % fin théorème@",pr:"\n\\cadre{vert}{Propriété}{ % id=p@ \n} % fin propriété@",rem:"\n\\bloc{cyan}{Remarque}{ % id=r@ \n} % fin remarque@",ex:"\n\\bloc{orange}{Exemple}{ % id=e@ \n} % fin exemple@",py:"\n\\begin{lstlisting}[language=Python]\n@\n\\end{lstlisting}@",link:"\\mcLien{/@}{@})",pdficon:'\\imgsvg{pdf-icon}{0.1}% alt="pdf-icon" style="width:2rem" ',cen:"\n\\begin{center}\n@\n\\end{center}@",cor:"\n\\begin{corrige}\n@\n\\end{corrige}","-l":"\n\\begin{itemize}[label=--]\n\\item\n@\n\\end{itemize}@",ul:"\n\\begin{itemize}\n\\item\n@\n\\end{itemize}@",al:"\n\\begin{enumerate}[label=\\alph*.]\n\\item\n@\n\\end{enumerate}@",alp:"[label=\\alph*.]@",ol:"\n\\begin{enumerate}\n\\item\n@\n\\end{enumerate}@",li:"\n\\item\n@",cut:"$\\nosp$@",ext:'\n\\begin{center}\n\\begin{extern}%alt="@" style="width:40rem"\n@\n\\end{extern}\n\\end{center}',img:'\n\\begin{center}\n\\img{@}{0.1}%alt="@" style="width:40rem"\n\\end{center}',svg:'\n\\begin{center}\n\\imgsvg{@}{0.3}% alt="@" style="width:30rem"\n\\end{center}',qv:"\n%---------------------------------------------\n\\intro{@}\n\\affirm{@}\n\\vrai{@}@",qf:"\n%---------------------------------------------\n\\intro{@}\n\\affirm{@}\n\\faux{@}@",tt:" \\texttt{@} ",ttp:" \\texttp{@} ",py:"\\begin{lstlisting}[language=Python]\n@\n\\end{lstlisting}@",table:'\\begin{tabularx}{0.8\\linewidth}{|*{3}{>{\\centering \\arraybackslash }X|}}%class="compact" width="600"\n     \\hline\n &   &  &   &   &  \n     \\\\ \\hline\n     &    &    &    &    &  \n     \\\\ \\hline\n     &   &   &   &  & \n     \\\\ \\hline\n\\end{tabularx}',t1:"\n   @",t2:"\n      @",t3:"\n         @",t4:"\n            @","\\vrai{}":"\n\\vrai{\nC'est vrai.\n\\par\n@\n}","\\vrai{}f":"\n\\faux{}@","\\faux{}v":"\n\\vrai{}@","\\faux{}":"\n\\faux{\nC'est faux.\n\\par\n@\n}",pdf:'\\imgsvg{pdf-icon}{0.1}% alt="pdf" style="width:2rem"\n\\mcLien{/assets/pdf/@.pdf}{Solution rédigée par @} ',tabvar:"%##\n% type=table; width=35; l3=20\n%--\n% x|   -\\infty   ~    \\frac{ 3 }{ 4 }   ~   4  ~   +\\infty \n% f'(x)|  ~       -               :0             +   :0   -     ~\n% f(x)|  +\\infty    \\          :0              /   :5   \\   -\\infty\n%--\n%##",tabvar2:"%##\n% type=table; width=35; l3=20; c7=2; c1=15\n%--\n% x|   -\\infty   ~    \\frac{ 3 }{ 4 }   ~   ~      9   ~    ~   +\\infty\n% f'(x)|  ~       -               :0             +    ~     :0    ~    -     ~\n% \\dfrac{\\text{e}^{x+1}-1}{x}|  +\\infty    \\     :0     /     +\\infty      ||   +\\infty     \\    -\\infty\n%--\n%##",tabsig:"%##\n% type=table; width=45; c1=30\n%--\n% x|   -\\infty   ~    \\frac{ 4 }{ 3 }   ~   3  ~   +\\infty \n% x-3|  ~       -               :        -   :0   +     ~\n% 4-3x|  ~       +               :0      -   :   -     ~\n% (x-3)(4-3x)|  ~    -       :0     +  :0   -   ~\n%--\n%##",tabsig2:"%##\n% type=table; width=40; c1=20; l4=15\n%--\n% x|   -\\infty   ~    \\frac{ 1 }{ 2 }   ~    \\frac{ 5 }{ 2 }   ~   +\\infty \n% 5-2x|  ~       +               :      +   :0   -     ~\n% 2x-1|  ~       -               :0     +  :   +     ~\n% \\dfrac{5-2x}{2x-1}|  ~    -       ||    +  :0   -   ~\n%--\n%##",arbre:"%##\n% type=arbre; width=25; wcell=3.5; hcell=1.5\n%--\n% >A:0,6\n% >>V:0,1\n% >>F:0,9\n% >\\overline{A}:0,4\n% >>V:0,8\n% >>F:0,2\n%--\n%##",fct:"%##\n% type=graphic;   width=30; \n% xmin=-4.5; xmax=4.5; ymin=-2.9; ymax=9.5; xunit=1; yunit=1\n%--\n%grid=1;subgriddiv=1\n%repere=0\n%axes=1\n%fct=x*x;linecolor=blue\n%fct=2*x-1;linecolor=red\n%text=\\blue \\mathscr{C}_f;pos=[t](3.5,9)\n%--\n%##",fct2:"%##\n% type=graphic;   width=30; \n% xmin=-4.5; xmax=4.5; ymin=-5.5; ymax=5.5; xunit=1; yunit=1\n%--\n%grid=1;subgriddiv=1\n%repere=0\n%axes=1\n%fct=1/x;linecolor=blue;def=\\xmin,-0.01\n%fct=1/x;linecolor=blue;def=0.01,\\xmax\n%fct=ln(x);linecolor=red;def=0.01,\\xmax\n%text=\\blue \\mathscr{C}_f;pos=[t](0.8,5)\n%--%##",geo:'%##\n% type=graphic; width=20; alt="Géométrie"\n% xmin=.01; xmax=6; ymin=0.01; ymax=6; xunit=1; yunit=1\n%--\n%grid=0;subgriddiv=1\n%repere=0\n%axes=0\n%point=A(1,1)(.7,.7);linecolor=blue\n%point=B(5,1)(5.3,.7);linecolor=blue\n%point=C(5,5)(5.3,5.3);linecolor=blue\n%point=D(1,5)(.7,5.3);linecolor=blue\n%ligne=A,B,C,D,A\n%--\n%##',cube:'%##\n% type=graphic; width=25; alt="Cube"\n% xmin=-.5; xmax=8; ymin=-.5; ymax=8; xunit=1; yunit=1\n%--\n%grid=0;subgriddiv=1\n%repere=0\n%axes=0\n%point=A(0,0)(-.3,0)\n%point=B(6,0)(6.4,0)\n%point=C(7,1)(7.3,1)\n%point=D(1,1)(.5,1)\n%point=E(0,6)(-.3,6)\n%point=F(6,6)(6.4,6)\n%point=G(7,7)(7.3,7)\n%point=H(1,7)(.5,7)\n%ligne=A,B,C\n%ligne=E,F,G,H,E\n%ligne=E,A\n%ligne=F,B\n%ligne=G,C\n%ligne=D,A;linestyle=dashed\n%ligne=D,C;linestyle=dashed\n%ligne=D,H;linestyle=dashed\n%--\n%##'};return e in t&&t[e]};static replaceShortkey=e=>{const t=e.selectionStart,n=e.value.substring(0,t).lastIndexOf("\n")+1,i=e.value.substring(n,t).trimEnd().lastIndexOf(" ")+n+1,r=e.value.substring(i,t),a=Shortkeys.fullTex(r,e);if(a){const n=a.indexOf("@");e.value=e.value.substring(0,i)+a.replace("@","")+e.value.substring(t),e.selectionStart=i+n,e.selectionEnd=e.selectionStart}};static fullTex=(e,t)=>{let n="@";return 1!=e.length||Shortkeys.inMaths(t)?(n=Shortkeys.maths(e),n?Shortkeys.inMaths(t)||(n="$ "+n+" $"):(n=Shortkeys.noMaths(e),n||(n=e+" @"))):n="$"+e+"$ @",n};static inMaths=e=>{const t=e.value.substring(0,e.selectionStart);return(t.length-t.replace(/\$/g,"").length)%2==1}}class Macros{static execMacro=e=>{let t=e.selectionStart,n=e.value;n=Macros.traiteMacros(n),e.value=n,e.selectionStart=t,e.selectionEnd=t};static traiteMacros=e=>{const t=e.split("%##");return t.length%2==0?e:(t.forEach(((e,t,n)=>{n[t]=t%2==1?Macros.traiteUneMacro(e.trim()):e.trim()})),e=t.join("\n%##\n"))};static traiteUneMacro=e=>{const t=e.split("%--");if(3!=t.length)console.log("Erreur macro : manque section %--");else{let n=Macros.strToVars(t[0]);const i=Macros.buildTikz(t[1],n);e=t[0].trim()+"\n%--\n"+t[1].trim()+"\n%--\n"+i.trim()}return e};static strToVars=e=>{const t=(e=e.replaceAll("%",";").replaceAll(/(\n|\r|\s)/g,"")).split(";");let n=[];const i={};let r=0;return t.forEach(((e,t)=>{n=e.split("="),2==n.length&&(r=parseFloat(n[1]),isNaN(r)&&(r=n[1]),i[n[0]]=r)})),i};static buildTikz=(e,t)=>"table"==t.type?Macros.buildTableTikz(e,t):"arbre"==t.type?Macros.buildArbreTikz(e,t):"graphic"==t.type?(console.log(t),Macros.buildGraphicTikz(e,t)):void 0;static splitArbreSource=e=>{const t=e.trim().replaceAll(/(\s|%)/gm,"").replaceAll(">","¦>").replaceAll(">¦",">").split("¦");t.shift(),console.log(t);let n=0,i="r",r="";const a={r:{content:""}};return t.forEach((e=>{if(">"==e[n])i+="a";else{for(;">"!=e[n];)n-=1;i=i.substring(0,n+1)+String.fromCharCode(i.charCodeAt(n+1)+1)}n+=1,r=e.substring(n),a[i]={content:r}})),Macros.calcArbreTopBottom(a,"r",0),console.log(a),a};static calcArbreTopBottom=(e,t,n)=>{e[t].top=n;let i,r=n,a="a";if(!(t+a)in e)e[t].bottom=n;else{for(;t+a in e;)i=r+("a"==a?0:1),r=Macros.calcArbreTopBottom(e,t+a,i),a=String.fromCharCode(a.charCodeAt(0)+1);e[t].bottom=r}return r};static buildArbreTikz=(e,t)=>{const n=[];n.push("\\begin{center}"),n.push(' \\begin{extern}%style="width:'+(t.width?t.width:"30")+'rem" alt="Arbre pondéré"'),n.push("    \\resizebox{11cm}{!}{"),n.push("       \\definecolor{dark}{gray}{0.1}"),n.push("       \\begin{tikzpicture}[scale=.8, line width=.5pt, dark]"),n.push("       \\def\\width{"+(t.wcell?t.wcell:"3")+"}"),n.push("       \\def\\height{"+(t.hcell?t.hcell:"1.5")+"}"),n.push("       \\tikzstyle{noeud}=[fill=white,circle,draw]"),n.push("       \\tikzstyle{poids}=[fill=white,font=\\footnotesize,midway]");const i=Macros.splitArbreSource(e);return Macros.buildNodeArbreTikz(i,"r",n),n.push("       \\end{tikzpicture}"),n.push("      }"),n.push("   \\end{extern}"),n.push("\\end{center}"),console.log(n),n.join("\n")};static buildNodeArbreTikz=(e,t,n)=>{const i=t.length,r=-(e[t].top+e[t].bottom)/2,a=e[t].content.split(":"),s=a.length>1?" node [poids] {$"+a[1]+"$}":"";n.push("    \\node[noeud] ("+t+") at ({"+i+"*\\width},{"+r+"*\\height}) {$"+a[0]+"$};"),t.length>1&&n.push("     \\draw ("+t.substr(0,t.length-1)+") -- ("+t+")"+s+";");let l="a";for(;t+l in e;)Macros.buildNodeArbreTikz(e,t+l,n),l=String.fromCharCode(l.charCodeAt(0)+1)};static splitTableSource=e=>(e=e.trim().replaceAll("\r","").replaceAll("\n","").replaceAll(/\s{2,}/g,"¦").replaceAll("%¦","%").replaceAll("¦%","%").replaceAll("% ","%").replaceAll(" %","%")).split("%");static calculateTableVars=(e,t)=>{e.nblignes=t.length,e.nbcols=t[0].split("¦").length,"wcell"in e||(e.wcell=10),"hcell"in e||(e.hcell=10),"wsep"in e||(e.wsep=8),e.xtabul=[0],e.ytabul=[0],e.xpos=[],e.ypos=[];for(let t=1;t<=e.nbcols;t++)e.xtabul[t]=e.xtabul[t-1]+("c"+t.toString()in e?e["c"+t.toString()]:t%2==1?e.wcell:e.wsep),e.xpos[t-1]=.5*(e.xtabul[t-1]+e.xtabul[t]);for(let t=1;t<=e.nblignes;t++)console.log("l"+t.toString()),console.log(e["l"+t.toString()]),e.ytabul[t]=e.ytabul[t-1]-("l"+t.toString()in e?e["l"+t.toString()]:e.hcell),e.ypos[t-1]=.5*(e.ytabul[t-1]+e.ytabul[t]);return console.log(e),e};static buildTableTikz=(e,t)=>{const n=[],i=[];let r=[],a=[],s="",l=Macros.splitTableSource(e);l=l.filter((e=>""!=e)),t=Macros.calculateTableVars(t,l),n.push("\\begin{center}"),n.push(' \\begin{extern}%style="width:'+(t.width?t.width:"30")+'rem" alt="Exercice"'),n.push("    \\resizebox{11cm}{!}{"),n.push("       \\definecolor{dark}{gray}{0.1}"),n.push("       \\definecolor{light}{gray}{0.8}"),n.push("       \\tikzstyle{fleche}=[->,>=latex]"),n.push("       \\begin{tikzpicture}[scale=.8, line width=.5pt, dark]"),n.push("       \\def\\width{.15}"),n.push("       \\def\\height{.10}");for(let e=0;e<t.nblignes;e++){for(let n=0;n<t.nbcols;n++)a[n]=t.ypos[e];r=l[e].split("¦");for(let n=1;n<t.nbcols;n++)s=r[n].trim(),"\\"==s&&(a[n-1]=(t.ypos[e]+t.ytabul[e])/2,a[n+1]=(t.ypos[e]+t.ytabul[e+1])/2),"/"==s&&(a[n-1]=(t.ypos[e]+t.ytabul[e+1])/2,a[n+1]=(t.ypos[e]+t.ytabul[e])/2);n.push("       \\draw (0, "+t.ytabul[e+1]+"*\\height) -- ("+t.xtabul[t.nbcols]+"*\\width, "+t.ytabul[e+1]+"*\\height);");for(let l=0;l<t.nbcols;l++)s=r[l].trim(),console.log(s),"||"==s&&(s="~",n.push("       \\draw[double distance=2pt] ("+t.xpos[l]+"*\\width, "+t.ytabul[e]+"*\\height) -- ("+t.xpos[l]+"*\\width, "+t.ytabul[e+1]+"*\\height);")),"|"==s[s.length-1]&&(s=s.substring(0,s.length-1),n.push("       \\draw ("+t.xtabul[l+1]+"*\\width, "+t.ytabul[e]+"*\\height) -- ("+t.xtabul[l+1]+"*\\width, "+t.ytabul[e+1]+"*\\height);")),"|"==s[s.length-1]&&(s=s.substring(0,s.length-1),n.push("       \\draw ("+t.xtabul[l+1]+"*\\width, "+t.ytabul[e]+"*\\height) -- ("+t.xtabul[l+1]+"*\\width, "+t.ytabul[e+1]+"*\\height);")),":"==s[0]&&(s=s.substring(1),n.push("       \\draw[light] ("+t.xpos[l]+"*\\width, "+t.ytabul[e]+"*\\height) -- ("+t.xpos[l]+"*\\width, "+t.ytabul[e+1]+"*\\height);")),"\\"!=s&&"/"!=s||(i.push("       \\draw[fleche] (l"+e+"c"+(l-1)+") -- (l"+e+"c"+(l+1)+");"),s="~"),n.push("       \\node (l"+e+"c"+l+") at ("+t.xpos[l]+"*\\width,"+a[l]+"*\\height) {$ "+s+" $};")}return n.push("       \\draw (0, 0) rectangle ("+t.xtabul[t.nbcols]+"*\\width, "+t.ytabul[t.nblignes]+"*\\height);"),n.push(i.join("\n")),n.push("       \\end{tikzpicture}"),n.push("      }"),n.push("   \\end{extern}"),n.push("\\end{center}"),n.join("\n")};static splitGraphicSource=e=>{e.replaceAll(/(\n\r)/gm,"").split("%").forEach((e=>{e=e.trim()}));return[]};static buildGraphicTikz=(e,t)=>{const n={},i=[];return i.push("\\begin{center}"),i.push(' \\begin{extern}%style="width:'+(t.width?t.width:"30")+'rem" alt="Fonction"'),i.push("    \\resizebox{11cm}{!}{"),i.push("       \\definecolor{dark}{gray}{0.1}"),i.push("       \\definecolor{light}{gray}{0.8}"),i.push("       \\def\\xmin{"+(t.xmin?t.xmin:"-5")+"}"),i.push("       \\def\\xmax{"+(t.xmax?t.xmax:"5")+"}"),i.push("       \\def\\ymin{"+(t.ymin?t.ymin:"-5")+"}"),i.push("       \\def\\ymax{"+(t.ymax?t.ymax:"5")+"}"),i.push("       \\def\\xunit{"+(t.xunit?t.xunit:"1")+"}"),i.push("       \\def\\yunit{"+(t.yunit?t.yunit:"1")+"}"),i.push("       \\psset{xunit=\\xunit, yunit=\\yunit, algebraic=true}"),i.push("       \\fontsize{15pt}{15pt}\\selectfont"),i.push("       \\begin{pspicture*}[linewidth=1pt](\\xmin,\\ymin)(\\xmax,\\ymax)"),e.replaceAll("\r","").replaceAll("\n","").split("%").forEach((e=>{Macros.buildGraphicLine(e,i,n)})),i.push("       \\end{pspicture*}"),i.push("      }"),i.push("   \\end{extern}"),i.push("\\end{center}"),i.join("\n")};static buildGraphicLine=(e,t,n)=>{let i=e.split(";"),r=i.shift().split("=");if(r.length<2)return;let a=r[0].trim(),s=r[1].trim(),l={};if(i.forEach((e=>{const t=e.split("=");2==t.length&&(l[t[0].trim()]=t[1].trim())})),console.log(s),"grid"==a&&"0"!=s){let e=Macros.getParamsString(l,{gridcolor:"light",subgriddiv:"1",gridlabels:"0pt"});console.log(e),t.push("       \\psgrid"+e+"(\\xmin,\\ymin)(\\xmax,\\ymax)")}else if("axes"==a&&"0"!=s)t.push("       \\psaxes[linewidth=0.75pt,showorigin=false]{->}(0,0)(\\xmin,\\ymin)(\\xmax,\\ymax)"),t.push("       \\rput(-0.5,-0.5){$O$}");else if("point"==a){let e=Macros.getParamsString(l,{dotsize:"2pt 0"});s=s.replaceAll(")","(");const i=s.replaceAll("((","(").split("("),r="linecolor"in l?"\\"+l.linecolor+" ":"";t.push("                    \\psdots"+e+"("+i[1]+")"),t.push("       \\rput("+i[2]+"){$"+r+i[0]+"$}"),console.log(n),n[i[0]]=i[1]}else if("cercle"==a){let e=Macros.getParamsString(l,{linecolor:"dark"});t.push("                    \\pscircle"+e+s)}else if("segment"==a){let e=Macros.getParamsString(l,{linecolor:"dark"});t.push("                    \\psline"+e+s)}else if("ligne"==a){let e=Macros.getParamsString(l,{linecolor:"dark"});const i=s.split(",");let r=i.shift();i.forEach((i=>{t.push("                    \\psline"+e+"("+n[r]+")("+n[i]+")"),r=i}))}else if("vecteur"==a){let e=Macros.getParamsString(l,{linecolor:"dark"});t.push("                    \\psline"+e+"{->}"+s)}else if("text"==a)t.push("       \\rput"+l.pos+"{$"+s+"$}");else if("repere"==a&&"0"!=s)t.push("       \\psline[linewidth=1.25pt]{->}(0,0)(0,1)"),t.push("       \\psline[linewidth=1.25pt]{->}(0,0)(1,0)"),t.push("       \\rput[t](0.5,-0.03){$\\overrightarrow{ i } $}"),t.push("       \\rput[r](-0.03,0.5){$\\overrightarrow{j}$}");else if("fct"==a){let e="{\\xmin}{\\xmax}";"def"in l&&(e="{"+l.def.replace(",","}{")+"}",delete l.def);let n=Macros.getParamsString(l,{linewidth:"1pt",plotpoints:"2000",linecolor:"dark"});t.push("       \\psplot"+n+e+"{"+s+"}")}};static getParamsString=(e,t={})=>{delete e.pos;let n={...t,...e},i=[];for(const e in n)n.hasOwnProperty(e)&&i.push(e+"="+n[e]);return 0==i.length?"":"["+i.join(",")+"]"}}class Tex2Html{constructor(e){this.model=e,this.extern_links={},this.maths=[],this.externs=[],this.pythons=[],this.tables=[],this.externsTable=[]}_findClosing(e,t){const n={"(":")","{":"}","[":"]","<":">","└":"┘","┌":"┐"},i=e[t];if(!(i in n))throw new Error(i+" is not a start symbol ");let r=1;const a=n[i];for(let n=t+1;n<e.length;n++)switch(e[n]){case i:r++;break;case a:if(0==--r)return n}return alert(" No matching closing parenthesis : ..."+e.substring(t-6,t+1)),t+1}_replace_cmd(e,t,n){console.log(e);let i=n.indexOf(e);for(;i>=0;){let r=i+e.length-1,a=this._findClosing(n,r),s=n.substring(0,i)+t[0]+n.substring(r+1,a)+t[1];for(let e=2;e<t.length;e++)r=a+1,a=this._findClosing(n,r),s+=n.substring(r+1,a)+t[e];i=(n=s+n.substring(a+1)).indexOf(e)}return n}_traite_liste(e){return["└","┌"].forEach(((t,n)=>{let i=0;for(;i>=0;)if(i=e.indexOf(t),i>=0){let t=this._findClosing(e,i);const r=e.substring(0,i),a=e.substring(t+1),s=this._traite_liste(e.substring(i+1,t-1)).split("\\item"),l=s.shift().trim(),o=0==n?"ol":"ul",c=0==n?l.indexOf("label=\\alph")>0?"question-alpha":"question":l.indexOf("label=---")>=0?"tiret":"dot",d='\n<li><p class="item">'+s.join('</p></li>\n<li><p class="item">')+"</p></li>";e=r+"</p>\n<"+o+' class="'+c+'">'+d+"\n</"+o+">\n<p>"+a}})),e}convert(e){return e=this.pretraite(e),e=this.convertTexte(e),this.externs.forEach(((e,t)=>{this.externs[t]=this.convertExtern(e,t)})),e=this.remplace("--e-x-t-e-r-n--",this.externs,e),this.maths.forEach(((e,t,n)=>{n[t]=this.convertMath(e)})),e=this.remplace("--m-a-t-h-s--",this.maths,e),this.pythons.forEach(((e,t,n)=>{n[t]=this.convertPython(e)})),e=this.remplace("--p-y-t-h-o-n--",this.pythons,e),e=this.posttraite(e)}remplace=(e,t,n)=>(t.forEach((t=>{n=n.replace(e,t)})),n);pretraite=e=>{this.maths=[],this.externs=[],this.pythons=[],this.tables=[];const t=(e=(e=(e=(e=e.replace(/\\\$/g,"&#36;")).replace(/\\\[/g,"\\begin{center}$")).replace(/\\\]/g,"$\\end{center}")).replace(/\\begin{extern}/g,"\\end{extern}")).split("\\end{extern}");t.forEach(((e,t,n)=>{t%2==1&&(this.externs.push(e),n[t]="--e-x-t-e-r-n--")}));const n=(e=(e=t.join("")).replace(/\\begin{lstlisting}\[language=Python\]/g,"\\end{lstlisting}")).split("\\end{lstlisting}");n.forEach(((e,t,n)=>{t%2==1&&(this.pythons.push(e),n[t]="--p-y-t-h-o-n--")}));const i=(e=n.join("")).split("$");i.length%2==1&&(i.forEach(((e,t,n)=>{t%2==1&&(this.maths.push(e),n[t]="--m-a-t-h-s--")})),e=i.join(""));const r=(e=(e=e.replace(/\\begin{tabularx?}/g,"\\end{tabular}")).replace(/\\end{tabularx}/g,"\\end{tabular}")).split("\\end{tabular}");return r.forEach(((e,t,n)=>{t%2==1&&(n[t]=this.convertTable(e))})),e=(e=(e=(e=(e=r.join("")).replace(/\\(input|meta){.*/g,"")).replace(/\\rule\[.*/g,"")).replace(/\\begin{tex}(.|\\n)*?\\end{tex}/g,"")).replace(/\\(begin|end){vbloc}\s*/g,""),e=this._replace_cmd("\\textcolor{",['<span style="color:','">',"</span>"],e)};posttraite=e=>("quiz"!=this.model.config.site&&(e="<p>"+e+"</p>"),(e=e.replace(/<p>\s*<\/p>/g,"")).trim());convertTexte=e=>{if(e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"<br>")).replace(/\\par|\\newpar/g,'</p>\n<p class="tex-par">\n')).replace(/\\newline/g,"<br>")).replace(/\\(med|small|big)(skip|break)/g,'</p>\n<p class="$1skip">')).replace(/\\begin{note}/g,'</p><div class="note"><p>')).replace(/\\end{note}/g,"</p></div><p>"),e=(e=(e=(e=this._replace_cmd("\\mintxtbox{",['</p>\n<span class="minbox"><p>',"</p>\n</span><p>"],e)).replace(/\\boite{(.*)%(.*)/g,"\\cboite{$2}{$1")).replace(/\\cadre{(.*)%(.*)/g,"\\ccadre{$2}{$1")).replace(/\\bloc{(.*)%(.*)/g,"\\cbloc{$2}{$1"),e=this._replace_cmd("\\boite{",['</p>\n<div class="boite boite-','">\n<h3>',"</h3>\n<p>","</p>\n</div><p>"],e),e=this._replace_cmd("\\cadre{",['</p>\n<div class="cadre cadre-','">\n<h3>',"</h3>\n<p>","</p>\n</div><p>"],e),e=this._replace_cmd("\\bloc{",['</p>\n<div class="bloc bloc-','">\n<h3>',"</h3>\n<p>","</p>\n</div><p>"],e),e=this._replace_cmd("\\minbox{",['<span class="minbox">',"</span>"],e),e=this._replace_cmd("\\cboite{",["</p>\n<div ",' class="boite boite-','">\n<h3>',"</h3>\n<p>","</p>\n</div><p>"],e),e=this._replace_cmd("\\ccadre{",["</p>\n<div ",' class="cadre cadre-','">\n<h3>',"</h3>\n<p>","</p>\n</div><p>"],e),e=(e=(e=(e=(e=this._replace_cmd("\\cbloc{",["</p>\n<div ",' class="bloc bloc-','">\n<h3>',"</h3>\n<p>","</p>\n</div><p>"],e)).replace(/\\begin{itemize}/g,"┌")).replace(/\\end{itemize}/g,"┐")).replace(/\\begin{enumerate}/g,"└")).replace(/\\end{enumerate}/g,"┘"),e=this._traite_liste(e),e=this._replace_cmd("\\textbf{",["<strong>","</strong>"],e),e=this._replace_cmd("\\textit{",["<em>","</em>"],e),e=this._replace_cmd("\\texttt{",['<span class="sans-serif">',"</span>"],e),e=this._replace_cmd("\\texttp{",['<span class="ss-python">',"</span>"],e),e=this._replace_cmd("\\emph{",["<em>","</em>"],e),e=this._replace_cmd("\\mcLien{",['<a href="','" target="_blank">',"</a>"],e),e=this._replace_cmd("\\Lien{",['<a href="','" target="_blank">',"</a>"],e),e=this._replace_cmd("\\svg-extern{",['<img src="','.svg"',' alt="" >'],e),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this._replace_cmd("\\imgsvg{",['<img src="/assets/imgsvg/','.svg" data-eps="','" alt="imgsvg" >'],e)).replace(/alt="imgsvg" >\s*%(.*)/g,"$1 >")).replace(/\\%/g,"&#37;")).replace(/%.*/g,"")).replace(/&#37;/g,"%")).replace(/\\(text)?backslash/g,"\\")).replace(/\\nosp/g,"")).replace(/\\`(A|E|I|O|U)/g,"&$1grave;")).replace(/\\'(A|E|I|O|U)/g,"&$1acute;")).replace(/(~|\\:|\\,)/g,"&nbsp;")).replace(/(~|\\:|\\,)/g,"&nbsp;")).replace(/\\euro({})?/g,"&euro;")).replace(/\\degres({})?/g,"°")).replace(/\\quad/g,'<span style="width:1.5em;"><span>')).replace(/\\(#|_)/g,"$1")).replace(/\\newpage/g,"<hr>")).replace(/\\og\s*/g,"&laquo;&nbsp;")).replace(/\s*\\fg({})?/g,"&nbsp;&raquo;")).replace(/\\begin{h([1-5])\}/g,"</p>\n<h$1>")).replace(/\\end{h([1-5])\}/g,"</h$1>\n<p>")).replace(/\\Partie{([^\}]*)\}/g,'<h2 class="center partie">Partie $1</h2>')).replace(/\\TitreC{([^\}]*)\}/g,'<h2 class="center partie">$1</h2>')).replace(/\\begin{center}/g,'</p><div class="center"><p>')).replace(/\\begin{indent}/g,'</p><div class="indent"><p>')).replace(/\\begin{encadrer}/g,'</p><div class="center encadrer"><p>')).replace(/\\end{(center|indent|encadrer)}/g,"</p></div><p>")).replace(/\\begin{corrige}/g,'</p><div class="volet"><h2><a>Corrigé</a></h2><div><p>')).replace(/\\begin{reponses}/g,'</p><div class="volet"><h2><a>Réponses</a></h2><div><p>')).replace(/\\begin{solution}/g,'</p><div class="volet"><h2><a>Solution</a></h2><div><p>')).replace(/\\end{(corrige|reponses|solution)}/g,"</p></div></div><p>")).replace(/\\begin{code}\s*\n/g,"</p><code>")).replace(/\s*\n\s*\\end{code}/g,"</code><p>")).replace(/\\begin{overflow}/,'<div style="overflow-x:auto;">',e)).replace(/\\end{overflow}/,"</div>",e)).replace("\\begin{overflow}",'<div style="overflow-x:auto;">',e)).replace("\\end{overflow}","</div>",e),"quiz"==this.model.config.site){const t=!(e.indexOf("vrai{}")>0||e.indexOf("faux{}")>0),n='<div class="fiche fiche--sujet fiche--sujet-__numquest__" id="fiche--sujet-__numquest__">',i='<div class="fiche__title"><span class="name">__classe__ - __name__</span><span class="numquest">__numquest__</span></div>',r=i+'<div class="encadre"><div class="encadre__intro">',a='<div class="encadre__affirm">',s=i+'<div class="encadre"><div class="encadre__affirm">',l='<div class="boutons"><a class="bouton bouton--vrai bouton--ok ob-slide"><span>VRAI</span></a><a class="bouton bouton--faux bouton--nok ob-slide"><span>FAUX</span></a></div></div>',o='<div class="boutons"><a class="bouton bouton--vrai bouton--nok ob-slide"><span>VRAI</span></a><a class="bouton bouton--faux bouton--ok ob-slide"><span>FAUX</span></a></div></div>',c='<div class="fiche fiche--explic fiche--explic-__numquest__" id="fiche--explic-__numquest__">'+i+'<div class="encadre"><div class="encadre__explic"><p>',d='</p></div></div><div class="boutons"><a class="bouton bouton--enonce ob-slide"><span>Énoncé</span></a><a class="bouton bouton--next ob-slide"><span>Question suivante</span></a></div></div>',h='<div class="fiche fiche--enonce fiche--enonce-__numquest__" id="fiche--enonce-__numquest__">'+i+'<div class="encadre">',p='</div><div class="boutons"><a class="bouton bouton--explic bouton--reponse ob-slide"><span>Réponse</span></a><a class="bouton bouton--next ob-slide"><span>Question suivante</span></a></div></div>',u='<div class="fiche fiche--reponse fiche--reponse-__numquest__" id="fiche--reponse-__numquest__">'+i+'<div class="encadre">',g='</div><div class="boutons"><a class="bouton bouton--explic ob-slide"><span>Explications</span></a><a class="bouton bouton--next ob-slide"><span>Question suivante</span></a></div></div>';e=e.replace(/\\intro{}\s*\\affirm\{/g,"\\inaffirm{"),e=this._replace_cmd("\\intro{",[n+r+"<p>","</p></div>"],e),e=this._replace_cmd("\\affirm{",[a+"<p>","</p></div></div>"],e),e=this._replace_cmd("\\inaffirm{",[n+s+"<p>","</p></div></div>"],e),t?(e=this._replace_cmd("\\vrai{",[l+h+p+u+g+c,d],e),e=this._replace_cmd("\\faux{",[o+h+p+u+g+c,d],e)):(e=this._replace_cmd("\\vrai{",[l+u+g,""],e),e=(e=this._replace_cmd("\\faux{",[o+u+g,""],e)).replace('<a class="bouton bouton--explic ob-slide"><span>Explications</span></a>',""))}return e};convertMath=e=>{e=(e=(e=(e=(e=e.replace(/''/g,"^{\\prime \\prime}")).replace(/'/g,"^{\\prime}")).replace(/-/g," - ")).replace(/\\s*<\\s*/g," &lt; ")).replace(/\\s*>\\s*/g," &gt; ");try{e=katex.renderToString(e,{displayMode:!0})}catch(t){if(!(t instanceof katex.ParseError))throw t;console.log("Error KaTeX '"+e+"': "+t.message)}return'<span class="katex-wrapper">'+e+"</span>"};convertPython=e=>{let t='<pre class="language-python line-numbers" tabindex="0"><code class="language-python">';t+=Prism.highlight(e.trim(),Prism.languages.python,"python"),t+='<span aria-hidden="true" class="line-numbers-rows">',console.log("python"),console.log(e);const n=(e.trim()+"\n").match(/\n/g).length;for(let e=0;e<n;e++)t+="<span></span>";return t+="</span></code></pre>",t};convertExtern=(e,t)=>this.externsTable.length>t?'<div class="extern" id="ext-'+t+'">'+this.externsTable[t]+"</div>":'<div class="extern" id="ext-'+t+'"><img src="/assets/img/loader.gif" style="width:3rem; display:block; margin:0 auto" ></div>';drawExtern=(e,t)=>{let n=new FormData;n.append("input",e),n.append("metas",JSON.stringify(this.model.getFileMetas())),fetch("/ajax/get-psimg",{method:"post",body:n}).then((n=>{n.text(n).then((n=>{this.externsTable=n.split("|"),t(e)}))}))};convertTable=e=>{const t=(e=(e=(e=e.replace(/&/gs,"|")).replace(/(\\\\|\n\\hline|\\hline|<br>)/gs,"")).replace(/\n(\s*\n)*/gs,"\n")).split("\n"),n=t.shift().split("%");let i='<div style="overflow-x:auto;"><table '+(n.length>1?n[1]:"")+">";return t.forEach((e=>{if(e.indexOf("|")>=0){i+="<tr>";e.trim().split("|").forEach((e=>{i+="<td>"+e+"</td>"})),i+="</tr>\n"}})),i+"</table></div>"}}class EditModel{constructor(){this.config=this.getConfig(),this.aide_visible=!1,this.metas={},this.backup="",this.input="",this.output="",this.pos=0,this.selection={start:0,end:0},this.file_rw=new FileRw(this),this.tex2html=new Tex2Html(this),this.modelChangedObserver=[]}getConfig=()=>{const e={},t=new URL(window.location.href);return e.basename=t.searchParams.get("file"),e.ftp_server="ftp.cluster026.hosting.ovh.net",e.ftp_id="mathscoukj",e.ftp_pw="f2T6ybtmdps",e["local-url"]="http://newmc.test/",e["remote-url"]="https://maths-cours.ovh/",e["local-dir"]="C:/laragon/www/newmc/",e["remote-dir"]="/www/",e["content-dir"]=e["local-dir"]+"assets/",e["content-url"]=e["local-url"]+"assets/",e["uploads-dir"]=e["content-dir"]+"uploads/",e["latex-dir"]=e["content-dir"]+"latex/",e["backup-dir"]=e["latex-dir"]+"backup/",e};setModelChangedObserver=e=>{this.modelChangedObserver.push(e)};modelChanged=()=>{this.modelChangedObserver.forEach((e=>{e(this.getData())}))};getData=()=>({aide_visible:this.aide_visible,metas:this.metas,input:this.input,output:this.output,selection:this.selection});inputChanged=e=>{console.log("inputChanged"),this.input=e,this.output=this.tex2html.convert(this.input),this.modelChanged()};externDraw=e=>{this.tex2html.externsTable=[],this.inputChanged(e),this.tex2html.drawExtern(e,this.inputChanged)};toggleAide=()=>{console.log("toggleAide"),this.aide_visible=!this.aide_visible,this.data_changed.action="toggleAide",this.modelChanged()};getFileMetas(){const e=this.input.match(/\\meta({.*)/g);let t={};return e.forEach((e=>{const n=e.split("{");t[n[1].substring(0,n[1].length-1)]=n[2].substring(0,n[2].length-1)})),t.slug=t.url.split("/")[2],t.basename=t.type+"_"+t.slug,t}doBackup=()=>{this.backup!=this.input&&(console.log("backup model"),this.backup=this.input,this.file_rw.backup(this.getFileMetas(),this.input))};transfert=()=>{this.file_rw.transfert(this.getFileMetas(),this.input,this.output,"remote")};transpdf=()=>{console.log(" transpdf"),this.file_rw.transfert_pdf(this.getFileMetas())};transdev=()=>{this.file_rw.transfert(this.getFileMetas(),this.input,this.output,"local")};transquiz=()=>{console.log("transquiz")};translistquiz=()=>{console.log("translistquiz")};cremodel=()=>{console.log("cremodel")};models=()=>{console.log("models")}}class EditInputView{constructor(){this._input=$id("source"),this.initEventListener()}start=()=>{this.inputChangedHandler(this._input.value),this.externDrawHandler(this._input.value)};initEventListener=()=>{$id("fullscreen").addEventListener("click",(e=>{document.body.classList.toggle("fullscreen")})),this._input.addEventListener("keydown",(e=>{"Tab"==e.code&&(this.nextTab(),e.preventDefault(),this.inputChangedHandler(this._input.value)),"F12"==e.code&&(e.preventDefault(),this.externDrawHandler(this._input.value)),"$"==e.key&&(this.insertAtCaret("$  $",2),e.preventDefault(),this.inputChangedHandler(this._input.value)),"Backquote"==e.code&&(e.preventDefault(),e.stopPropagation(),Shortkeys.replaceShortkey(this._input),this.inputChangedHandler(this._input.value))})),this._input.addEventListener("input",(e=>{Macros.execMacro(this._input),this.inputChangedHandler(this._input.value)}))};setInputChangedHandler=e=>{this.inputChangedHandler=e};setExternDrawHandler=e=>{this.externDrawHandler=e};nextTab=()=>{const e=this._input,t=e.selectionStart,n=e.value.indexOf("@",t);n<0?(e.value=e.value.substring(0,t)+"   "+e.value.substring(t),e.selectionStart=t+3,e.selectionEnd=t+3):(e.value=e.value.substring(0,n)+e.value.substring(n+1),e.selectionStart=n,e.selectionEnd=n)};insertAtCaret=(e,t)=>{const n=this._input,i=n.selectionStart;n.value=n.value.substring(0,i)+e+n.value.substring(i),n.selectionStart=i+t,n.selectionEnd=i+t}}class EditOutputView{constructor(){this._output=$id("html_content"),this._text=$id("text-content")}modelChanged=e=>{this._output.innerHTML=e.output,this._text.innerHTML=e.output}}class EditController{constructor(){this.model=new EditModel,this.inputView=new EditInputView,this.outputView=new EditOutputView,this.model.setModelChangedObserver(this.modelChanged),this.inputView.setInputChangedHandler(this.inputChanged),this.inputView.setExternDrawHandler(this.externDraw),this.inputView.start(),window.setInterval((()=>{this.model.doBackup()}),3e4)}inputChanged=e=>{this.model.inputChanged(e)};externDraw=e=>{this.model.externDraw(e)};modelChanged=e=>{this.outputView.modelChanged(e)}}class Batch{constructor(){this.i_post=0,$id("batch").addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.batch_handler()}))}batch_handler=()=>{let e=JSON.parse(post_ids);fetch("/ajax/get-post/"+e[this.i_post].id,{method:"get"}).then((e=>e.text().then((e=>{console.log(e),this.i_post+=1}))))}}class List{constructor(){$id("select-list").addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.list_handler()}))}list_handler=()=>{let e="",t=$id("category").value;"all"!=t&&(e+="/category/"+t);let n=$id("classe").value;"all"!=n&&(e+="/classe/"+n);let i=$id("status").value;"all"!=i&&(e+="/status/"+i),window.location.href="/admin/posts/list"+e}}var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(e){var t=/\blang(?:uage)?-([\w-]+)\b/i,n=0,i={},r={manual:!0,disableWorkerMessageHandler:e.Prism&&e.Prism.disableWorkerMessageHandler,util:{encode:function e(t){return t instanceof a?new a(t.type,e(t.content),t.alias):Array.isArray(t)?t.map(e):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++n}),e.__id},clone:function e(t,n){var i,a;switch(n=n||{},r.util.type(t)){case"Object":if(a=r.util.objId(t),n[a])return n[a];for(var s in i={},n[a]=i,t)t.hasOwnProperty(s)&&(i[s]=e(t[s],n));return i;case"Array":return a=r.util.objId(t),n[a]?n[a]:(i=[],n[a]=i,t.forEach((function(t,r){i[r]=e(t,n)})),i);default:return t}},getLanguage:function(e){for(;e&&!t.test(e.className);)e=e.parentElement;return e?(e.className.match(t)||[,"none"])[1].toLowerCase():"none"},currentScript:function(){if("undefined"==typeof document)return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(i){var e=(/at [^(\r\n]*\((.*):.+:.+\)$/i.exec(i.stack)||[])[1];if(e){var t=document.getElementsByTagName("script");for(var n in t)if(t[n].src==e)return t[n]}return null}},isActive:function(e,t,n){for(var i="no-"+t;e;){var r=e.classList;if(r.contains(t))return!0;if(r.contains(i))return!1;e=e.parentElement}return!!n}},languages:{plain:i,plaintext:i,text:i,txt:i,extend:function(e,t){var n=r.util.clone(r.languages[e]);for(var i in t)n[i]=t[i];return n},insertBefore:function(e,t,n,i){var a=(i=i||r.languages)[e],s={};for(var l in a)if(a.hasOwnProperty(l)){if(l==t)for(var o in n)n.hasOwnProperty(o)&&(s[o]=n[o]);n.hasOwnProperty(l)||(s[l]=a[l])}var c=i[e];return i[e]=s,r.languages.DFS(r.languages,(function(t,n){n===c&&t!=e&&(this[t]=s)})),s},DFS:function e(t,n,i,a){a=a||{};var s=r.util.objId;for(var l in t)if(t.hasOwnProperty(l)){n.call(t,l,t[l],i||l);var o=t[l],c=r.util.type(o);"Object"!==c||a[s(o)]?"Array"!==c||a[s(o)]||(a[s(o)]=!0,e(o,n,l,a)):(a[s(o)]=!0,e(o,n,null,a))}}},plugins:{},highlightAll:function(e,t){r.highlightAllUnder(document,e,t)},highlightAllUnder:function(e,t,n){var i={callback:n,container:e,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};r.hooks.run("before-highlightall",i),i.elements=Array.prototype.slice.apply(i.container.querySelectorAll(i.selector)),r.hooks.run("before-all-elements-highlight",i);for(var a,s=0;a=i.elements[s++];)r.highlightElement(a,!0===t,i.callback)},highlightElement:function(n,i,a){var s=r.util.getLanguage(n),l=r.languages[s];n.className=n.className.replace(t,"").replace(/\s+/g," ")+" language-"+s;var o=n.parentElement;o&&"pre"===o.nodeName.toLowerCase()&&(o.className=o.className.replace(t,"").replace(/\s+/g," ")+" language-"+s);var c={element:n,language:s,grammar:l,code:n.textContent};function d(e){c.highlightedCode=e,r.hooks.run("before-insert",c),c.element.innerHTML=c.highlightedCode,r.hooks.run("after-highlight",c),r.hooks.run("complete",c),a&&a.call(c.element)}if(r.hooks.run("before-sanity-check",c),(o=c.element.parentElement)&&"pre"===o.nodeName.toLowerCase()&&!o.hasAttribute("tabindex")&&o.setAttribute("tabindex","0"),!c.code)return r.hooks.run("complete",c),void(a&&a.call(c.element));if(r.hooks.run("before-highlight",c),c.grammar)if(i&&e.Worker){var h=new Worker(r.filename);h.onmessage=function(e){d(e.data)},h.postMessage(JSON.stringify({language:c.language,code:c.code,immediateClose:!0}))}else d(r.highlight(c.code,c.grammar,c.language));else d(r.util.encode(c.code))},highlight:function(e,t,n){var i={code:e,grammar:t,language:n};return r.hooks.run("before-tokenize",i),i.tokens=r.tokenize(i.code,i.grammar),r.hooks.run("after-tokenize",i),a.stringify(r.util.encode(i.tokens),i.language)},tokenize:function(e,t){var n=t.rest;if(n){for(var i in n)t[i]=n[i];delete t.rest}var r=new o;return c(r,r.head,e),l(e,r,t,r.head,0),function(e){var t=[],n=e.head.next;for(;n!==e.tail;)t.push(n.value),n=n.next;return t}(r)},hooks:{all:{},add:function(e,t){var n=r.hooks.all;n[e]=n[e]||[],n[e].push(t)},run:function(e,t){var n=r.hooks.all[e];if(n&&n.length)for(var i,a=0;i=n[a++];)i(t)}},Token:a};function a(e,t,n,i){this.type=e,this.content=t,this.alias=n,this.length=0|(i||"").length}function s(e,t,n,i){e.lastIndex=t;var r=e.exec(n);if(r&&i&&r[1]){var a=r[1].length;r.index+=a,r[0]=r[0].slice(a)}return r}function l(e,t,n,i,o,h){for(var p in n)if(n.hasOwnProperty(p)&&n[p]){var u=n[p];u=Array.isArray(u)?u:[u];for(var g=0;g<u.length;++g){if(h&&h.cause==p+","+g)return;var m=u[g],f=m.inside,b=!!m.lookbehind,x=!!m.greedy,v=m.alias;if(x&&!m.pattern.global){var _=m.pattern.toString().match(/[imsuy]*$/)[0];m.pattern=RegExp(m.pattern.source,_+"g")}for(var y=m.pattern||m,w=i.next,k=o;w!==t.tail&&!(h&&k>=h.reach);k+=w.value.length,w=w.next){var C=w.value;if(t.length>e.length)return;if(!(C instanceof a)){var A,E=1;if(x){if(!(A=s(y,k,e,b)))break;var S=A.index,M=A.index+A[0].length,$=k;for($+=w.value.length;S>=$;)$+=(w=w.next).value.length;if(k=$-=w.value.length,w.value instanceof a)continue;for(var T=w;T!==t.tail&&($<M||"string"==typeof T.value);T=T.next)E++,$+=T.value.length;E--,C=e.slice(k,$),A.index-=k}else if(!(A=s(y,0,C,b)))continue;S=A.index;var P=A[0],z=C.slice(0,S),O=C.slice(S+P.length),q=k+C.length;h&&q>h.reach&&(h.reach=q);var L=w.prev;if(z&&(L=c(t,L,z),k+=z.length),d(t,L,E),w=c(t,L,new a(p,f?r.tokenize(P,f):P,v,P)),O&&c(t,w,O),E>1){var D={cause:p+","+g,reach:q};l(e,t,n,w.prev,k,D),h&&D.reach>h.reach&&(h.reach=D.reach)}}}}}}function o(){var e={value:null,prev:null,next:null},t={value:null,prev:e,next:null};e.next=t,this.head=e,this.tail=t,this.length=0}function c(e,t,n){var i=t.next,r={value:n,prev:t,next:i};return t.next=r,i.prev=r,e.length++,r}function d(e,t,n){for(var i=t.next,r=0;r<n&&i!==e.tail;r++)i=i.next;t.next=i,i.prev=t,e.length-=r}if(e.Prism=r,a.stringify=function e(t,n){if("string"==typeof t)return t;if(Array.isArray(t)){var i="";return t.forEach((function(t){i+=e(t,n)})),i}var a={type:t.type,content:e(t.content,n),tag:"span",classes:["token",t.type],attributes:{},language:n},s=t.alias;s&&(Array.isArray(s)?Array.prototype.push.apply(a.classes,s):a.classes.push(s)),r.hooks.run("wrap",a);var l="";for(var o in a.attributes)l+=" "+o+'="'+(a.attributes[o]||"").replace(/"/g,"&quot;")+'"';return"<"+a.tag+' class="'+a.classes.join(" ")+'"'+l+">"+a.content+"</"+a.tag+">"},!e.document)return e.addEventListener?(r.disableWorkerMessageHandler||e.addEventListener("message",(function(t){var n=JSON.parse(t.data),i=n.language,a=n.code,s=n.immediateClose;e.postMessage(r.highlight(a,r.languages[i],i)),s&&e.close()}),!1),r):r;var h=r.util.currentScript();function p(){r.manual||r.highlightAll()}if(h&&(r.filename=h.src,h.hasAttribute("data-manual")&&(r.manual=!0)),!r.manual){var u=document.readyState;"loading"===u||"interactive"===u&&h&&h.defer?document.addEventListener("DOMContentLoaded",p):window.requestAnimationFrame?window.requestAnimationFrame(p):window.setTimeout(p,16)}return r}(_self);
/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */function doc_ready(){-1!=loadModule.indexOf("edit")&&new EditController,-1!=loadModule.indexOf("batch")&&new Batch,-1!=loadModule.indexOf("list")&&new List}"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism),Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0},"string-interpolation":{pattern:/(?:f|rf|fr)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:{{)*){(?!{)(?:[^{}]|{(?!{)(?:[^{}]|{(?!{)(?:[^{}])+})+})+}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|rb|br)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|rb|br)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^\s*)@\w+(?:\.\w+)*/im,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:and|as|assert|async|await|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:True|False|None)\b/,number:/(?:\b(?=\d)|\B(?=\.))(?:0[bo])?(?:(?:\d|0x[\da-f])[\da-f]*(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?j?\b/i,operator:/[-+%=]=?|!=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python,Prism.languages.py=Prism.languages.python,function(){if(void 0!==Prism&&"undefined"!=typeof document){var e="line-numbers",t=/\n(?!$)/g,n=Prism.plugins.lineNumbers={getLine:function(t,n){if("PRE"===t.tagName&&t.classList.contains(e)){var i=t.querySelector(".line-numbers-rows");if(i){var r=parseInt(t.getAttribute("data-start"),10)||1,a=r+(i.children.length-1);n<r&&(n=r),n>a&&(n=a);var s=n-r;return i.children[s]}}},resize:function(e){r([e])},assumeViewportIndependence:!0},i=void 0;window.addEventListener("resize",(function(){n.assumeViewportIndependence&&i===window.innerWidth||(i=window.innerWidth,r(Array.prototype.slice.call(document.querySelectorAll("pre.line-numbers"))))})),Prism.hooks.add("complete",(function(n){if(n.code){var i=n.element,a=i.parentNode;if(a&&/pre/i.test(a.nodeName)&&!i.querySelector(".line-numbers-rows")&&Prism.util.isActive(i,e)){i.classList.remove(e),a.classList.add(e);var s,l=n.code.match(t),o=l?l.length+1:1,c=new Array(o+1).join("<span></span>");(s=document.createElement("span")).setAttribute("aria-hidden","true"),s.className="line-numbers-rows",s.innerHTML=c,a.hasAttribute("data-start")&&(a.style.counterReset="linenumber "+(parseInt(a.getAttribute("data-start"),10)-1)),n.element.appendChild(s),r([a]),Prism.hooks.run("line-numbers",n)}}})),Prism.hooks.add("line-numbers",(function(e){e.plugins=e.plugins||{},e.plugins.lineNumbers=!0}))}function r(e){if(0!=(e=e.filter((function(e){var t=function(e){if(!e)return null;return window.getComputedStyle?getComputedStyle(e):e.currentStyle||null}(e)["white-space"];return"pre-wrap"===t||"pre-line"===t}))).length){var n=e.map((function(e){var n=e.querySelector("code"),i=e.querySelector(".line-numbers-rows");if(n&&i){var r=e.querySelector(".line-numbers-sizer"),a=n.textContent.split(t);r||((r=document.createElement("span")).className="line-numbers-sizer",n.appendChild(r)),r.innerHTML="0",r.style.display="block";var s=r.getBoundingClientRect().height;return r.innerHTML="",{element:e,lines:a,lineHeights:[],oneLinerHeight:s,sizer:r}}})).filter(Boolean);n.forEach((function(e){var t=e.sizer,n=e.lines,i=e.lineHeights,r=e.oneLinerHeight;i[n.length-1]=void 0,n.forEach((function(e,n){if(e&&e.length>1){var a=t.appendChild(document.createElement("span"));a.style.display="block",a.textContent=e}else i[n]=r}))})),n.forEach((function(e){for(var t=e.sizer,n=e.lineHeights,i=0,r=0;r<n.length;r++)void 0===n[r]&&(n[r]=t.children[i++].getBoundingClientRect().height)})),n.forEach((function(e){var t=e.sizer,n=e.element.querySelector(".line-numbers-rows");t.style.display="none",t.innerHTML="",e.lineHeights.forEach((function(e,t){n.children[t].style.height=e+"px"}))}))}}}(),"loading"!==document.readyState?doc_ready():document.addEventListener("DOMContentLoaded",doc_ready);